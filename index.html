<!DOCTYPE html>
<style>

/*body {
  background: #012;
}*/

</style>
<body>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script>

var rects = {
    w: 15,
    e: []
};

var h = 0;

for(var i = 0 ; i < 32 ; i++)
{
    rects.e.push(
        {
            v: 1 + Math.floor(Math.random()*127),
            x: i*rects.w + i*3,
            c: "rgb( 0, 0, 0)"
        }
        );
    if(h < rects.e[i].v) h = rects.e[i].v;
}

var w = rects.e.length*rects.w + (rects.e.length-1)*3;

function render() {
    d3.select("body").select("svg").remove();
    var svg = d3.select("body").append("svg")
        .attr("width", w)
        .attr("height", h);
    for(var i = 0 ; i < rects.e.length ; i++)
    {
        var e = rects.e[i];
        svg.append("rect")
            .attr("x", e.x)
            .attr("y", h-e.v)
            .attr("width", rects.w)
            .attr("height", e.v)
            .attr("fill", e.c);
    }
}

render();

var e = [];

for(var i = 0 ; i < rects.e.length ; i++)
{
    e.push(rects.e[i].v);
}

var ops = [];

for(var i = 1 ; i < e.length ; i++)
{

    var j = i;

    while(true)
    {
        if(j <= 0)
        {
            break;
        }
        if(e[j] >= e[j-1])
        {
            break;
        }
        ops.push({
            t: "swap",
            p: {
                a: new Number(j),
                b: new Number(j-1)
            }
        })
        var tmp = e[j];
        e[j] = e[j-1];
        e[j-1] = tmp;
        j--;
    }
}

function sort(){
    while(ops.length != 0) {
        var op = ops[0];
        if(op.t == "swap") {
            console.log("swap("+op.p.a+","+op.p.b+"), "+rects.e[op.p.a].v+", "+rects.e[op.p.b].v);
            var tmp = rects.e[op.p.a].v;
            rects.e[op.p.a].v = rects.e[op.p.b].v;
            rects.e[op.p.b].v = tmp;

            render();
            
            ops.shift();
            break;
        } else {
            ops.shift();
        }
    }
    if(ops.length != 0)
    {
        setTimeout(sort, 100);
    }
    console.log("done");
}

sort();

</script>

