<!DOCTYPE html>
<style>

/*body {
  background: #012;
}*/

</style>
<body>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script>


var l = 32;

var val = [];

// generate [ 1, 2, ..., l ]
for(var i = 0 ; i < l ; i++)
{
    val.push(i+1);
}

// shuffle
for (var i = val.length - 1; i > 0; i -= 1) {
    var j = Math.floor(Math.random() * (i + 1));
    temp = val[i];
    val[i] = val[j];
    val[j] = temp;
}

var rects = {
    w: 15,
    e: []
};

var h = 0; // the height of the svg window

// visually represent the elements
for(var i = 0 ; i < l ; i++)
{
    rects.e.push(
        {
            v: val[i]*4, // the element value is represented as height of the rectangle
            x: i*rects.w + i*3, // the x position of the element
            c: "rgb( 0, 0, 0)" // color of the element (currently not used)
        }
        );
    if(h < rects.e[i].v) 
        h = rects.e[i].v; // update the height ( the max height is known to be l+1 in this case )
}



var w = rects.e.length*rects.w + (rects.e.length-1)*3; // the width of svg window
var s = 2; 

function render() {
    d3.select("body").select("svg").remove();
    var svg = d3.select("body").append("svg")
        .attr("width", w)
        .attr("height", h);
    for(var i = 0 ; i < rects.e.length ; i++)
    {
        var e = rects.e[i];
        svg.append("rect")
            .attr("x", e.x)
            .attr("y", h-e.v)
            .attr("width", rects.w)
            .attr("height", e.v)
            .attr("fill", e.c);
    }
    var lx = s*(rects.w + 3) - 3/2; 
    svg.append("g")
        .attr("stroke", "rgb(255,0,0)")
        .attr("stroke-width", "3")
        .append("line")
            .attr("x1", lx)
            .attr("x2", lx)
            .attr("y1", 0)
            .attr("y2", h);
}

render();

var e = [];

for(var i = 0 ; i < rects.e.length ; i++)
{
    e.push(rects.e[i].v);
}

var ops = [];

for(var i = 1 ; i < e.length ; i++)
{

    var j = i;

    while(true)
    {
        if(j <= 0)
        {
            break;
        }
        if(e[j] >= e[j-1])
        {
            break;
        }
        ops.push({
            t: "swap",
            p: {
                a: new Number(j),
                b: new Number(j-1)
            }
        })
        var tmp = e[j];
        e[j] = e[j-1];
        e[j-1] = tmp;
        j--;
    }
    ops.push({
        t: "incr",
        p: { }
    })
}

function sort(){
    while(ops.length != 0) {
        var op = ops[0];
        if(op.t == "swap") {
            
            var tmp = rects.e[op.p.a].v;
            rects.e[op.p.a].v = rects.e[op.p.b].v;
            rects.e[op.p.b].v = tmp;

            render();
            
            ops.shift();
            break;
        } else if (op.t == "incr") { 
            s++;
            render();

            ops.shift();
            break;
        } else {
            ops.shift();
        }
    }
    if(ops.length != 0)
    {
        setTimeout(sort, 250);
    }
}

sort();

</script>

